name: For_each
run-name: Deploy Infra
on:
  push:
    branches:
      - main
      - 'features/*'
jobs:
  terraform_init_and_infra:
    name: firstjob1
    permissions:
      id-token: write
      contents: read
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v5.0.0
       #  with:
       #  # Repository name with owner. For example, actions/checkout
       #  repository: # optional, default is ${{ github.repository }}
       # # The branch, tag or SHA to checkout. When checking out the repository that triggered a workflow, this defaults to the reference or SHA for that event.  Otherwise, uses the default branch.
       #  path: # optional
      
      - name: Azure Login
        uses: Azure/login@v2.3.0
        with:
          client-id: e591c629-ffe4-436a-a606-be198be68948
          # TenantId of the Azure Service principal created.
          tenant-id: f646197d-1724-4e4c-9dfb-fefa7f8eb52e
          # Azure subscriptionId
          subscription-id: f0c6c28a-7429-42b3-aefa-63439e20a651
      - name: Terraform Init
        working-directory: for_each
        id: init
        run: terraform init -input=false 
      - name: Terraform fmt
        # working-directory: ./for_each
        id: fmt
        run: terraform fmt -check
        continue-on-error: true
      - name: Terraform validate
        id: validate
        run: terraform validate -no-color
        continue-on-error: true
      - name: Terraform Plan
        id: Plan
        run: terraform plan
        continue-on-error: true
